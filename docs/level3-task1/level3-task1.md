author: HvA
summary: Mad Level 3 - Task 1
id: level3-task1
categories: Apps
tags: apps
status: Published
feedback link: https://github.com/pmeijer-hva/mad-codelabs/issues
analytics account: UA-180951198-1

# MAD Level 3 - Task 1

## Overview

### Requirements

We are going to build a Game Rating app consisting of three screens:
- Start screen
- Rating screen where the user can rate a random game from 1 to 5 stars
- Summary screen where the rated game will be shown with a button to reset the flow

// TODO add GIF

### Solution

Below you can find the necessary steps to build this app. If you encounter problems you can always 
check the [repository](https://github.com/Marcellis/MadLevel3Task1) where you can find the whole solution.

### Create a new project

We’ll start this tutorial by creating a new Android Studio project. We’ll use a different template from now on.

Once you have successfully downloaded and installed Android Studio you need to ‘Start a new project’.
- Select ‘Basic Activity’. 
- Name the application ‘MadLevel3Task1’
- Choose API 23
- Choose language ‘Kotlin’
- Press finish getting started.

## Reusing the Basic Activity template 

// TODO Add picture

By now we know we can use the `Fragments` generated by the `Basic Activity` project template. 
We are going to refactor these in a similar way as was done at the example.

1. Rename  `FirstFragment` to `StartFragment` and `SecondFragment` to `RatingFragment`. Do the same for the two selected layout files 
shown on the image(with proper naming conventions)

2. Remove the click listeners in both Kotlin fragment files.

3. In `nav_graph.xml` all the fragment and action attributes accordingly.

4. Remove the Floating Action Button(FAB) from `activity_main.xml` along with the linked `clickListener` in `MainActivity`

## StartFragment
// TODO add picture

- Alter the `fragment_start.xml` so that it matches the image on the left. 

Positive
: Now that you’re getting familiar with `ConstraintLayout`, try to use a `Vertical Chain` to group the elements vertically! 
Toggle between chain modes to get the right positioning between the elements! Chains are mostly useful when trying to group
a set of elements and either `pack` them or `spread` them across a view.

// TODO add picture

- Make sure that in `onViewCreated(..)` in the `StartFragment` you are navigating to the `RatingFragment` on the button click. 
See the code below, make sure to test it!

``` kotlin
btn_start_rating.setOnClickListener {
      findNavController().navigate(
         R.id.action_startFragment_to_ratingFragment
      )
}
```

## RatingFragment 

### Layout with a random game

1. Alter the fragment_rating.xml so that it matches the image on the left. 
You can use the <RatingBar /> element for the stars. The game name will be randomized in step 2

2. Now in RatingFragment we want to show a randomized game name in the TextView. Add the following function.

```kotlin 
private fun showRandomAssessableGame() {
   val randomGame = listOf("Red Dead Redemption 2", "Rocket League",
       "Shadow of the Tombraider").random()

   txt_game.text = randomGame
}
```

Make sure to call this function in `onViewCreated(..)`.

The user can now select an amount of stars and click “To Summary” where he or she will be taken to the summary screen. 
The summary screen will give a nice overview of what was rated and will have a button to start over. These are our next steps!

### Create a new destination

Open `nav_graph.xml` and toggle the Design view(top right corner):

// TODO add picture

Now you’ll see our two fragments. We are going to add a new Destination(`SummaryFragment`) via the green plus sign:

// TODO add picture

A pop-up appears, click “Create new destination”. Choose Fragment (blank) and name it `SummaryFragment` .

Unfortunately Android Studio generates some methods and fields in `SummaryFragment` which we don’t need. 
The only code we need in the fragment for now is the code below, make sure to strip the rest of the code out of the class!

```kotlin 
class SummaryFragment : Fragment() {

   override fun onCreateView(
       inflater: LayoutInflater, container: ViewGroup?,
       savedInstanceState: Bundle?
   ): View? {
       // Inflate the layout for this fragment
       return inflater.inflate(R.layout.fragment_summary, container, false)
   }
}
```

After adding the destination we need to create two navigation actions. One from the `RatingFragment` to the `SummaryFragment` 
and one to reset the flow when leaving the `SummaryFragment` to go back to the `StartFragment`. When you’re hovering your 
mouse over a fragment frame in the editor you can see a dot on the right side of it. Drag this to the destination fragment 
to create an action. 

The blue lines in the image below highlight the added actions:

// TODO add picture

This will generate two ***<action .. />*** attributes in the XML.

### Sending arguments to the SummaryFragment

The summary screen needs to know what game was rated and what the rating itself was. 

- In the new `SummaryFragment.kt` we are going to add two constants above the class definition. 
These we will use later to indicate which data will be sent.

``` kotlin
const val ARG_GAME_NAME = "arg_game_name"
const val ARG_GAME_RATING = "arg_game_rating"

class SummaryFragment : Fragment() {
..
}
```

- Now switch back to `RatingFragment.kt`. Add the following code:

``` kotlin 
override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
   super.onViewCreated(view, savedInstanceState)

   btn_to_summary.setOnClickListener {
       navigateToSummary()
   }

   showRandomAssessableGame()
}

private fun navigateToSummary() {

   val args = Bundle()
   args.putFloat(ARG_GAME_RATING, rb_game.rating)
   args.putString(ARG_GAME_NAME, txt_game.text.toString())

   findNavController().navigate(R.id.action_ratingFragment_to_summaryFragment, args)
}
```

We’re creating a function sends the rated game name and the rating wrapped in a `Bundle` to the `SummaryFragment`. 
This function is triggered by the click of the “To Summary” button. 

Positive
: Test this to see if you can navigate from the rating screen to the summary screen.

## SummaryFragment

### Setup the layout and show the summary

- First, change the `fragment_summary.xml`. It has a `FrameLayout` by default after it’s been generated. 
For this reason and the fact that you’ve made two layouts already you can use the XML on the left.

``` xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
   xmlns:app="http://schemas.android.com/apk/res-auto"
   xmlns:tools="http://schemas.android.com/tools"
   android:layout_width="match_parent"
   android:layout_height="match_parent">

   <TextView
       android:id="@+id/txt_summary"
       style="@android:style/TextAppearance.Material.Headline"
       android:layout_width="match_parent"
       android:layout_height="wrap_content"
       android:layout_marginStart="16dp"
       android:layout_marginEnd="16dp"
       android:gravity="center"
       app:layout_constraintBottom_toTopOf="@+id/btn_start_over"
       app:layout_constraintEnd_toEndOf="parent"
       app:layout_constraintStart_toStartOf="parent"
       app:layout_constraintTop_toTopOf="parent"
       app:layout_constraintVertical_chainStyle="packed" />

   <Button
       android:id="@+id/btn_start_over"
       android:layout_width="0dp"
       android:layout_height="wrap_content"
       android:layout_marginStart="16dp"
       android:layout_marginTop="16dp"
       android:layout_marginEnd="16dp"
       android:text="@string/start_over"
       app:layout_constraintBottom_toBottomOf="parent"
       app:layout_constraintEnd_toEndOf="parent"
       app:layout_constraintHorizontal_bias="0.5"
       app:layout_constraintStart_toStartOf="parent"
       app:layout_constraintTop_toBottomOf="@+id/txt_summary" />
</androidx.constraintlayout.widget.ConstraintLayout>
```

- Then in `SummaryFragment` we retrieve the arguments sent by the `RatingFragment` and show it on the screen.

``` kotlin
const val ARG_GAME_NAME = "arg_game_name"
const val ARG_GAME_RATING = "arg_game_rating"
```

- Lastly, we add a `click listener` to reset the app back to the start screen

``` kotlin
class SummaryFragment : Fragment() {

   ...

   override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
       super.onViewCreated(view, savedInstanceState)

       val gameName = arguments?.getString(ARG_GAME_NAME)
       val gameRating = arguments?.getFloat(ARG_GAME_RATING)

       txt_summary.text = String.format("You rated %s with %.1f stars! Thanks?", gameName, gameRating)

       btn_start_over.setOnClickListener {
           findNavController().navigate(R.id.action_summaryFragment_to_startFragment)
       }

   }

}
```

### Clear the backstack when exiting the SummaryFragment

We don’t want the user to navigate back once the “Start over” button is clicked. To do this, 
we need to add some attributes to the `action` that brings the user back from the `SummaryFragment` to the `StartFragment`. 
The two highlighted attributes below clear the `backstack`. Now when the user tries to navigate back from the start screen, 
he will exit the app.

`nav_graph.xml`

``` xml
<?xml version="1.0" encoding="utf-8"?>
<navigation ..

   ..

   <fragment
       android:id="@+id/summaryFragment"
       android:name="nl.hva.level3task1.SummaryFragment"
       android:label="fragment_summary"
       tools:layout="@layout/fragment_summary" >


       <action
         android:id="@+id/action_summaryFragment_to_startFragment"
           app:popUpToInclusive="true"
           app:popUpTo="@id/startFragment"
           app:destination="@id/startFragment" />
   </fragment>
</navigation>
```

Positive
: Now test the app! Go through the flow and try to navigate back and forth. Also check if you can’t navigate back to the 
summary screen after completing the flow. When everything is working push your app to your Git repository!

